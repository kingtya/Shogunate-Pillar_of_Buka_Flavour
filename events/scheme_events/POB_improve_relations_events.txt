namespace = pob_improve_relations_events

pob_improve_relations_events.0002 = {
	hidden = yes

	immediate = {
		scope:scheme = {
			scheme_target_character = {
				save_scope_as = target
			}
			scheme_owner = {
				save_scope_as = owner
				#SUCCESS ROLL

				random = {
					chance = scope:scheme.scheme_success_chance
					save_scope_value_as = {
						name = scheme_successful
						value = yes
					}
				}

				if = {
					limit = {
						scope:owner = {
							is_ruler = no
						}
						exists = scope:owner.liege
					}
					scope:owner.liege ?= {
						save_scope_as = liege
					}
					scope:liege = {
						if = {
							limit = { exists = scope:scheme_successful }
							trigger_event = pob_improve_relations_events.1001
						}
						else = {
							trigger_event = pob_improve_relations_events.1002
						}
					}
				}
				else = {
					if = {
						limit = { exists = scope:scheme_successful }
						trigger_event = pob_improve_relations_events.1001
					}
					else = {
						trigger_event = pob_improve_relations_events.1002
					}
				}
			}
		}
	}
}

pob_improve_relations_events.1001 = {
	type = character_event
	title = pob_improve_relations_events.1001.t
	desc = pob_improve_relations_events.1001.desc
	theme = crown

	left_portrait = {
		character = root
		animation = throne_room_applaud_1
	}
	right_portrait = {
		trigger = {
			NOT = { root = scope:owner }
		}
		character = scope:owner
		animation = throne_room_bow_1
	}
	lower_center_portrait = {
		trigger = {
			NOT = { root = scope:owner }
		}
		character = scope:target
	}
	lower_right_portrait = {
		trigger = {
			root = scope:owner
		}
		character = scope:target
	}

	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}

	immediate = {
		play_music_cue = "mx_cue_positive_effect"
		scope:target = {
			add_opinion = {
				target = root
				modifier = pob_improve_relations_task_increased_opinion
				days = 1825
			}
		}
	}

	option = {
		name = pob_improve_relations_events.1001.a
	}

	after = {
		if = {
			limit = { exists = scope:scheme }
			scope:scheme = {
				end_scheme = yes
			}
		}
	}
}

pob_improve_relations_events.1002 = {
	type = character_event
	title = pob_improve_relations_events.1002.t
	desc = pob_improve_relations_events.1002.desc
	theme = crown

	left_portrait = {
		character = scope:owner
		animation = worry
	}
	right_portrait = {
		trigger = {
			NOT = { root = scope:owner }
		}
		character = root
		animation = anger
	}
	lower_center_portrait = {
		trigger = {
			NOT = { root = scope:owner }
		}
		character = scope:target
	}
	lower_right_portrait = {
		trigger = {
			root = scope:owner
		}
		character = scope:target
	}

	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}

	immediate = {
		play_music_cue = "mx_cue_negative"
		scopr:target = {
			add_opinion = {
				target = root
				modifier = pob_improve_relations_task_decreased_opinion
				days = 1825
			}
		}
	}

	option = {
		name = {
			text = pob_improve_relations_events.1002.a
		}
		show_as_tooltip = {
			scope:scheme = {
				end_scheme = yes
			}
		}
	}

	after = {
		hidden_effect = {
			scope:scheme ?= {
				end_scheme = yes
			}
		}
	}
}